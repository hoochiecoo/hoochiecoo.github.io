<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†—ã–Ω–æ–∫ –ü—Ä–æ–¥—É–∫—Ç–æ–≤ –°—É–±–æ—Ç–∏—Ü—ã</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
            background-color: #f4f4f4;
        }
        h1 {
            color: #007BFF;
            font-size: 1.8em;
            text-align: center;
            margin: 20px 0;
        }
        .description {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin: 0 auto 20px;
            max-width: 600px;
        }
        .description h2 {
            margin-top: 0;
            font-size: 1.5em;
        }
        .feature {
            margin-bottom: 10px;
        }
        #uploadForm {
            text-align: center;
            margin-bottom: 20px;
        }
        #uploadForm input[type="file"] {
            display: inline-block;
            margin-right: 10px;
        }
        #uploadForm button {
            padding: 10px 20px;
            font-size: 1em;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #uploadForm button:hover {
            background-color: #0056b3;
        }
        #photoFeed {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            padding: 10px;
        }
        .photo {
            border: 1px solid #ccc;
            border-radius: 5px;
            overflow: hidden;
            background-color: #fff;
        }
        .photo img {
            width: 100%;
            height: auto;
            display: block;
        }
    </style>
</head>
<body>
    <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –†—ã–Ω–æ–∫ –ü—Ä–æ–¥—É–∫—Ç–æ–≤ –°—É–±–æ—Ç–∏—Ü—ã!</h1>
    <div class="description">
        <h2>–û–±–∑–æ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:</h2>
        <div class="feature">üì∏ –û–ø—É–±–ª–∏–∫—É–π—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–∞–≤–∫–∞ –≤—Å–µ–≥–æ –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –∏ –ø—Ä–∏–≤–ª–µ–∫–∏—Ç–µ –±–æ–ª—å—à–µ –∫–ª–∏–µ–Ω—Ç–æ–≤.</div>
        <div class="feature">‚è∞ –ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –º–æ–∂–Ω–æ —Ä–∞–∑ –≤ —á–∞—Å.</div>
        <div class="feature">üë®‚Äçüíº –ù–∞—à –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–ª–µ–¥–∏—Ç –∑–∞ –∫–∞—á–µ—Å—Ç–≤–æ–º: —Ç–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø–æ–ø–∞–¥—É—Ç –Ω–∞ —Å–∞–π—Ç.</div>
        <div class="feature">üí∞ –ù–∞ –≤–∞—à–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–∞—Ö –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–∫–∞–∑–∞–Ω—ã —Ü–µ–Ω—ã.</div>
        <div class="feature">üìç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ä—ã–Ω–∫–∞: —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 123, –ì–æ—Ä–æ–¥, –°—Ç—Ä–∞–Ω–∞ (46.08979045045075, 19.646471153391175).</div>
    </div>

    <form id="uploadForm">
        <input type="file" id="photoInput" accept="image/*" capture="environment">
        <button type="button" onclick="checkLocationAndUpload()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
    </form>

    <button id="saveLocationBtn" onclick="saveUserLocation()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>

    <div id="photoFeed"></div>

    <script>
        const MAX_FILE_SIZE = 100 * 1024; // 100 KB
        const MAX_DIMENSION = 2000; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ø–∏–∫—Å–µ–ª—è—Ö
        const MARKET_LOCATION = { lat: 46.10287538629475, lng: 19.678124226170087 }; // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ä—ã–Ω–∫–∞

        function resizeImage(file, callback) {
            const reader = new FileReader();
            reader.onload = function (event) {
                const img = new Image();
                img.onload = function () {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    let width = img.width;
                    let height = img.height;

                    if (width > height) {
                        if (width > MAX_DIMENSION) {
                            height = Math.round((height * MAX_DIMENSION) / width);
                            width = MAX_DIMENSION;
                        }
                    } else {
                        if (height > MAX_DIMENSION) {
                            width = Math.round((width * MAX_DIMENSION) / height);
                            height = MAX_DIMENSION;
                        }
                    }

                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);

                    canvas.toBlob(function (blob) {
                        callback(blob);
                    }, 'image/jpeg', 0.75);
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }

        function compressImage(file, callback) {
            resizeImage(file, function (resizedBlob) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    const img = new Image();
                    img.onload = function () {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        let width = img.width;
                        let height = img.height;

                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);

                        let quality = 0.8;
                        function compress() {
                            canvas.toBlob(function (blob) {
                                if (blob.size <= MAX_FILE_SIZE || quality <= 0.7) {
                                    callback(blob);
                                } else {
                                    quality -= 0.05;
                                    compress();
                                }
                            }, 'image/jpeg', quality);
                        }

                        compress();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(resizedBlob);
            });
        }

        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –∫–∏–ª–æ–º–µ—Ç—Ä–∞—Ö
            const dLat = (lat2 - lat1) * (Math.PI / 180);
            const dLng = (lng2 - lng1) * (Math.PI / 180);
            const a = Math.sin(dLat / 2) ** 2 +
                Math.cos(lat1 * (Math.PI / 180)) * Math.cos(lat2 * (Math.PI / 180)) *
                Math.sin(dLng / 2) ** 2;
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            const distance = R * c; // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –∫–∏–ª–æ–º–µ—Ç—Ä–∞—Ö
            return distance;
        }

        function checkLocationAndUpload() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    const userLat = position.coords.latitude;
                    const userLng = position.coords.longitude;
                    const distance = calculateDistance(userLat, userLng, MARKET_LOCATION.lat, MARKET_LOCATION.lng);

                    if (distance > 1) {
                        alert('–í—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ –æ—Ç —Ä—ã–Ω–∫–∞ (–±–æ–ª–µ–µ 1 –∫–º). –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∑–∞–ø—Ä–µ—â–µ–Ω–∞.');
                        return;
                    }

                    uploadPhoto();
                }, function () {
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.');
                });
            } else {
                alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é.');
            }
        }

        function saveUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    const userLat = position.coords.latitude;
                    const userLng = position.coords.longitude;
                    localStorage.setItem('userLocation', JSON.stringify({ lat: userLat, lng: userLng }));
                    alert('–í–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ.');
                }, function () {
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.');
                });
            } else {
                alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é.');
            }
        }

        function uploadPhoto() {
            const input = document.getElementById('photoInput');
            const file = input.files[0];

            if (!file) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏.');
                return;
            }

            compressImage(file, function (compressedBlob) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    const photoData = event.target.result;
                    const photos = JSON.parse(localStorage.getItem('photos')) || [];
                    photos.push(photoData);
                    localStorage.setItem('photos', JSON.stringify(photos));
                    location.reload(); // Refresh the page to show new photos
                };
                reader.readAsDataURL(compressedBlob);
            });
        }

        function displayPhotos() {
            const photoFeed = document.getElementById('photoFeed');
            photoFeed.innerHTML = '';

            const photos = JSON.parse(localStorage.getItem('photos')) || [];
            photos.forEach(photoData => {
                const div = document.createElement('div');
                div.classList.add('photo');
                div.innerHTML = `<img src="${photoData}" alt="–§–æ—Ç–æ">`;
                photoFeed.appendChild(div);
            });
        }

        // Display photos on page load
        displayPhotos();
    </script>
</body>
</html>
