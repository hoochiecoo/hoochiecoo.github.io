<html lang="en">
  <head>
    <!-- Load the Telegram Library -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
      // Function to parse URL query parameters
      function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
      }

      // Function to handle button click
      function handleButtonClick() {
        // Get initData from window object
        var initData = window.Telegram.WebApp.initData;

        // Parse initData to extract user information
        var userString = getParameterByName('user', initData);
        var userObj = JSON.parse(decodeURIComponent(userString));

        // Extract user ID and name
        var userId = userObj.id;
        var userName = userObj.first_name + ' ' + userObj.last_name;

        // Update header with user name and ID
        document.getElementById('userHeader').innerText = userName + ' (ID: ' + userId + ')';

        // Simulated data for sending to bot
        var testData = { message: "Hello from WebApp!", userId: userId, userName: userName };

        // Send data to bot
        sendDataToBot(testData);
      }

      // Function to send data back to Telegram bot
      function sendDataToBot(data) {
        window.Telegram.WebApp.sendData(JSON.stringify(data));
      }

      // Simulated initialization
      window.onload = function () {
        // Simulated button setup
        var mainButton = window.Telegram.WebApp.MainButton;
        mainButton.text = "Send Message";
        mainButton.enable();
        mainButton.show();

        // Simulated button click event
        mainButton.onClick(handleButtonClick);
      };
    </script>
    <style>
      body {
        position: relative;
        margin: 0;
        padding: 0;
      }
      #userHeader {
        background-color: #f0f0f0;
        padding: 10px;
        text-align: center;
        font-size: 18px;
        border-bottom: 1px solid #ccc;
      }
      #iframeContainer {
        position: absolute;
        top: 50px; /* Adjust top margin as needed */
        left: 0;
        width: 100%;
        height: calc(100% - 50px); /* Adjust height to leave space for header */
        border: none;
      }
    </style>
  </head>
  <body>
    <div id="userHeader"></div>
    <div id="iframeContainer">
      <iframe src="https://datawrapper.dwcdn.net/5vcmO/" frameborder="0" style="width: 100%; height: 100%;"></iframe>
    </div>
  </body>
</html>
